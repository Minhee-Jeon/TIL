# Node.js 핵심 개념

> Node.js는 Chrome V8 Javascript 엔진으로 빌드된 Javascript 런타임입니다.     

기존에는 브라우저 외 환경에서 자바스크립트를 실행할 때 js 엔진의 속도가 너무 느려서 js 프로그램을 웹 브라우저 위에서만 실행할 수 있었음.
2008년 구글이 V8 엔진을 이용해 크롬을 출시했는데, 이 V8 엔진은 매우 빨랐고 V8과 libuv 라이브러리 기반의 Node가 탄생했음.      
libuv 라이브러리는 노드의 특성인 **이벤트 기반, 논 블로킹 I/O 모델**을 구현하고 있음.

## 이벤트 기반(event-driven)

이벤트가 발생할 때 미리 지정해둔 작업을 수행하는 방식.
ex) 클릭, 네트워크 요청

이벤트 리스너에 콜백 함수를 등록해두면

```    
-> 이벤트 발생      
-> 이벤트 리스너에 등록된 콜백 함수 호출      
-> 다음 이벤트 발생까지 대기  ... (반복)
```

**이벤트 루프**: 이벤트 발생 시 호출할 콜백 함수들을 관리하고 호출된 콜백 함수의 실행 순서를 결정합니다. 노드가 종료될 때까지 이벤트 처리를 위한 작업을 반복해요.     

**백그라운드**: `setTimeout` 등과 같은 타이머 / 이벤트 리스너들이 대기하고 있는 곳. 여러 작업이 동시에 실행될 수 있어요.   

**태스크 큐**: 이벤트 발생 후 백그라운드에서는 태스크 큐로 타이머나 이벤트 리스너의 콜백 함수를 보냅니다. 



## 논 블로킹 I/O

I/O의 일종: 파일 시스템 접근(파일 읽기/쓰기, 폴더 만들기), 네트워크를 통한 요청 등    

논 블로킹: 이전 작업이 완료될 때까지 대기하지 않고 다음 작업이 수행됨       
블로킹: 이전 작업이 끝나야만 다음 작업을 수행함

자바스크립트 코드는 동시에 실행될 수 없어요. 하지만 js상에서 돌아가는 것이 아닌 I/O 작업은 동시 처리가 가능해요.   
노드는 I/O 작업을 백그라운드로 넘겨 동시에 처리하며 시간 절약이 가능해요.

**논 블로킹**과 **동시**는 같은 의미가 아니예요. 동시성은 동시 처리가 가능한 작업을 논 블로킹 처리해야 얻을 수 있어요.

## 스레드

- 프로세스: 운영체제에서 할당하는 작업의 단위. 노드/웹 브라우저 같은 프로그램은 개별적인 프로세스며 메모리 등의 자원을 공유하지 않아요.
- 스레드: 프로세스 내에서 실행되는 흐름의 단위. 프로세스 내에서 여러 개 생성되어 여러 작업을 동시에 처리해요. 스레드들은 부모 프로세스의 자원을 공유하는데, 같은 주소의 메모리에 접근할 수 있어 데이터를 공유할 수 있어요.


#### 노드는 싱글 스레드다?

엄밀히 말하면 싱글 스레드로 동작하진 않아요. 노드를 실행하면 프로세스가 하나 생성되고 그 프로세스에서 내부적으로 스레드들을 생성하는데, 그 중 개발자가 직접 제어할 수 있는 스레드가 하나뿐이라 흔히 노드가 싱글 스레드로 여겨져요.

#### 노드가 싱글 스레드로 동작하지 않는 두 가지 경우

1. 스레드풀 (Thread Pool)

   노드가 **암호화**, **파일 입출력**, **압축** 등의 동작을 수행할 때 스스로 멀티 스레드를 사용해요.

2. 워커 스레드(Worker Thread)

   노드 12버전에서 안정화된 기능. 노드에서도 직접 다수의 스레드를 다룰 수 있어요. CPU 작업이 많은 경우 워커 스레드를 사용하면 됩니다.

---

## 서버   

네트워크를 통해 클라이언트의 요청으로 정보나 서비스를 제공하는 컴퓨터/프로그램.   
클라이언트는 요청을 보내는 주체로 브라우저일 수도, 데스크톰 프로그램일 수도, 모바일 앱일 수도, 다른 서버에 요청을 보내는 서버일 수 있다.    

## 서버로서의 노드

노드나 자바스크립트는 기본적으로 싱글 스레드, 논 블로킹 모델을 사용
-> 노드 서버의 장단점 = 싱글 스레드, 논 블로킹 모델의 장단점

서버에서는 기본적으로 I/O 요청이 많이 발생

노드는 libuv 라이브러리로 I/O 작업을 논 블로킹 방식으로 처리 (논 블로킹 방식 코딩을 했다는 가정 하)

-> 스레드 하나가 많은 수의 I/O를 혼자서도 감당 가능

:x:**부적합**:: CPU 부하가 큰 작업: 스레드 하나가 혼자 감당하기 어려워요!

:o: **적합**:: 개수는 많지만 크기는 작은 데이터를 실시간으로 주고받을 때

ex) 실시간 채팅 애플리케이션, 주식 차트, JSON 데이터를 제공하는 API 서버

:white_check_mark: 노드의 장점

- 멀티 스레드 방식에 비해 적은 컴퓨터 자원을 사용

- 웹 서버가 내장되어 있어 입문자가 쉽게 접근할 수 있다. (서버 규모가 커지면 nginx 등의 웹 서버를 노드 서버와 연결해야...)
- 서버 ~  웹 브라우저까지 js 한 언어만으로 웹 사이트를 개발할 수 있어 개발 생산성 up
- js 형식인 JSON 형식과 쉽게 호한됨


:broken_heart: 노드의 단점

- 기본적으로 싱글 스레드라서 CPU 코어를 하나만 사용               
- 하나뿐인 스레드가 멈추지 않도록 관리가 필요
- 서버 규모가 커졌을 때 서버 관리가 어려움
- 어중간한 성능



## 서버 외의 노드

노드는 자바스크립트 런타임이라 서버 용도로만 한정 X

- 노드 기반 웹 프레임워크
  - 앵귤러, 리액트, 뷰
- 모바일 개발 도구
  - 리액트 네이티브
- 데스크탑 개발 도구
  - 일렉트론
